NAME = postscriptbarcode

SWIG_INTERFACE = ../$(NAME).i

SWIG_WRAP  = $(NAME)_wrap.c
SWIG_EXTRA = $(NAME).java $(NAME)JNI.java BWIPP.java

JAVA_CRUFT = $(wildcard *.class)
JAVA_OUT = lib$(NAME).so 

ifeq ("$(JAVA_HOME)","")
  WHICH_JAVAC := $(shell which javac)
  ifneq ($(WHICH_JAVAC),)
    WHICH_JAVAC := $(dir $(realpath $(WHICH_JAVAC)))
    JAVA_HOME := $(patsubst %/bin/,%,$(WHICH_JAVAC))
  endif
endif

cleanlist += $(SWIG_WRAP) $(SWIG_EXTRA) $(JAVA_OUT) $(JAVA_CRUFT)

.PHONY: all swig-perl install uninstall clean

all: swig-java

swig-java: $(JAVA_OUT)

$(JAVA_OUT): $(SWIG_WRAP) $(SWIG_EXTRA)
	gcc -fPIC -shared -O2 -g				\
		$<						\
		-o lib$(NAME).so -l$(NAME)	\
		-I$(JAVA_HOME)/include				\
		-I$(JAVA_HOME)/include/linux

$(SWIG_WRAP) $(SWIG_EXTRA):
	swig -Wall -java -o $(SWIG_WRAP) -outdir . $(SWIG_INTERFACE)

install: $(JAVA_OUT)

uninstall:

clean:
	$(RM) $(cleanlist)

